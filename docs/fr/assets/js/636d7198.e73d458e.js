"use strict";(self.webpackChunk_joplin_doc_builder=self.webpackChunk_joplin_doc_builder||[]).push([[1098],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,h=d["".concat(s,".").concat(m)]||d[m]||u[m]||i;return n?o.createElement(h,a(a({ref:t},c),{},{components:n})):o.createElement(h,a({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,a[1]=l;for(var p=2;p<i;p++)a[p]=n[p];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},52442:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return a},default:function(){return u},frontMatter:function(){return i},metadata:function(){return l},toc:function(){return p}});var o=n(87462),r=(n(67294),n(3905));const i={sidebar_label:"Note viewer isolation",title:"Note viewer isolation",description:"The desktop application's note viewer runs in an iframe with a different protocol from the main application's top-level frame. Rationale Running the note viewer from a different protocol and/or dom..."},a="Note viewer isolation",l={unversionedId:"dev/spec/note_viewer_isolation",id:"dev/spec/note_viewer_isolation",title:"Note viewer isolation",description:"The desktop application's note viewer runs in an iframe with a different protocol from the main application's top-level frame. Rationale Running the note viewer from a different protocol and/or dom...",source:"@site/help/dev/spec/note_viewer_isolation.md",sourceDirName:"dev/spec",slug:"/dev/spec/note_viewer_isolation",permalink:"/fr/help/dev/spec/note_viewer_isolation",draft:!1,editUrl:"https://github.com/laurent22/joplin/tree/dev/readme/dev/spec/note_viewer_isolation.md",tags:[],version:"current",frontMatter:{sidebar_label:"Note viewer isolation",title:"Note viewer isolation",description:"The desktop application's note viewer runs in an iframe with a different protocol from the main application's top-level frame. Rationale Running the note viewer from a different protocol and/or dom..."},sidebar:"helpSidebar",previous:{title:"Markdown with Front Matter Exporter/Importer",permalink:"/fr/help/dev/spec/interop_with_frontmatter"},next:{title:"Plugin system architecture",permalink:"/fr/help/dev/spec/plugins"}},s={},p=[{value:"Rationale",id:"rationale",level:2},{value:"Why does a different protocol improve performance/security?",id:"why-does-a-different-protocol-improve-performancesecurity",level:2},{value:"The protocol",id:"the-protocol",level:2},{value:"<code>joplin-content://</code> only has access to specific directories",id:"joplin-content-only-has-access-to-specific-directories",level:2},{value:"Why not the <code>sandbox</code> property?",id:"why-not-the-sandbox-property",level:2}],c={toc:p},d="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"note-viewer-isolation"},"Note viewer isolation"),(0,r.kt)("div",{className:"donate-links"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.paypal.com/donate/?business=E8JMYD2LQ8MMA&no_recurring=0&item_name=I+rely+on+donations+to+maintain+and+improve+the+Joplin+open+source+project.+Thank+you+for+your+help+-+it+makes+a+difference%21&currency_code=EUR"},(0,r.kt)("img",{parentName:"a",src:"https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/Donate-PayPal-green.svg",alt:"Donate using PayPal"}))," ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/sponsors/laurent22/"},(0,r.kt)("img",{parentName:"a",src:"https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/GitHub-Badge.svg",alt:"Sponsor on GitHub"}))," ",(0,r.kt)("a",{parentName:"p",href:"https://www.patreon.com/joplin"},(0,r.kt)("img",{parentName:"a",src:"https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/Patreon-Badge.svg",alt:"Become a patron"}))," ",(0,r.kt)("a",{parentName:"p",href:"https://joplinapp.org/donate/#donations"},(0,r.kt)("img",{parentName:"a",src:"https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/Donate-IBAN.svg",alt:"Donate using IBAN"})))),(0,r.kt)("p",null,"The desktop application's note viewer runs in an ",(0,r.kt)("inlineCode",{parentName:"p"},"iframe")," with a different protocol from the main application's top-level frame."),(0,r.kt)("h2",{id:"rationale"},"Rationale"),(0,r.kt)("p",null,"Running the note viewer from a different protocol and/or domain moves the ",(0,r.kt)("inlineCode",{parentName:"p"},"iframe"),"'s content to a separate process. This has at least two benefits:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Reduces the impact of bugs in Joplin's HTML sanitizer."),(0,r.kt)("li",{parentName:"ol"},"Improves performance when rendering large notes (see ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/laurent22/joplin/issues/10424"},"issue #10424"),").")),(0,r.kt)("h2",{id:"why-does-a-different-protocol-improve-performancesecurity"},"Why does a different protocol improve performance/security?"),(0,r.kt)("p",null,"Using a different domain and/or protocol for the note viewer does the following:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://www.chromium.org/developers/design-documents/site-isolation/"},"enables Chromium's site isolation")," and"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy#cross-origin_script_api_access"},"prevents the note viewer from accessing the top-level context through ",(0,r.kt)("inlineCode",{parentName:"a"},"window.top")),".")),(0,r.kt)("h2",{id:"the-protocol"},"The protocol"),(0,r.kt)("p",null,"We use Electron's ",(0,r.kt)("a",{parentName:"p",href:"https://www.electronjs.org/docs/latest/api/protocol#protocolhandlescheme-handler"},"protocol.handle")," to register the ",(0,r.kt)("inlineCode",{parentName:"p"},"joplin-content://")," protocol."),(0,r.kt)("p",null,"We use a ",(0,r.kt)("inlineCode",{parentName:"p"},"file://")," URL to load the base electron application."),(0,r.kt)("p",null,"We use a ",(0,r.kt)("inlineCode",{parentName:"p"},"joplin-content://note-viewer/")," URL to load the note viewer and the resources it contains."),(0,r.kt)("p",null,"For compatibility with renderer plugins that use absolute resource paths ",(0,r.kt)("inlineCode",{parentName:"p"},"joplin-content://note-viewer/")," fetches files relative to the ",(0,r.kt)("inlineCode",{parentName:"p"},"/")," directory."),(0,r.kt)("p",null,"Here's an example:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The note viewer loads with the URL ",(0,r.kt)("inlineCode",{parentName:"li"},"joplin-content://note-viewer/tmp/.mount_JoplinA7E0A/path/to/the/note/viewer/here.html")),(0,r.kt)("li",{parentName:"ul"},"The note renders and includes a resource with the path ",(0,r.kt)("inlineCode",{parentName:"li"},"/home/user/.config/joplin-desktop/path/here.css")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"/home/user/.config/joplin-desktop/path/here.css")," is converted to ",(0,r.kt)("inlineCode",{parentName:"li"},"joplin-content://note-viewer/home/user/.config/joplin-desktop/path/here.css")," by Electron."),(0,r.kt)("li",{parentName:"ul"},"Joplin checks to make sure the ",(0,r.kt)("inlineCode",{parentName:"li"},"joplin-content://")," protocol has access to ",(0,r.kt)("inlineCode",{parentName:"li"},"/home/user/.config/joplin-desktop/path/here.css"),". If it does, it fetches and returns the file.")),(0,r.kt)("h2",{id:"joplin-content-only-has-access-to-specific-directories"},(0,r.kt)("inlineCode",{parentName:"h2"},"joplin-content://")," only has access to specific directories"),(0,r.kt)("p",null,"When ",(0,r.kt)("inlineCode",{parentName:"p"},"handleCustomProtocols")," creates a handler for the ",(0,r.kt)("inlineCode",{parentName:"p"},"joplin-content://")," protocol, it returns an object that allows certain directories to be marked as readable."),(0,r.kt)("p",null,"By default, the list of readable directories includes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The app bundle"),(0,r.kt)("li",{parentName:"ul"},"Data directories for each of the enabled plugins"),(0,r.kt)("li",{parentName:"ul"},"The resource directory"),(0,r.kt)("li",{parentName:"ul"},"The profile directory")),(0,r.kt)("h2",{id:"why-not-the-sandbox-property"},"Why not the ",(0,r.kt)("a",{parentName:"h2",href:"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#sandbox"},(0,r.kt)("inlineCode",{parentName:"a"},"sandbox"))," property?"),(0,r.kt)("p",null,"Enabling ",(0,r.kt)("inlineCode",{parentName:"p"},"sandbox")," disables Electron's PDF viewer (",(0,r.kt)("a",{parentName:"p",href:"https://github.com/whatwg/html/pull/6946"},"related HTML spec change"),") and prevents content within the note viewer from displaying/requesting resources."))}u.isMDXComponent=!0}}]);