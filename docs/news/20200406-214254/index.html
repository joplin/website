<!DOCTYPE html>
<html lang="en-gb">

<!--

!!! WARNING !!!

This file was auto-generated from readme/news/20200406-214254.md and any manual change
made to it will be overwritten. To make a change to this file please modify
the source Markdown file:

https://github.com/laurent22/joplin/blob/dev/readme/news/20200406-214254.md

-->

	<head>
		<!-- Google Tag Manager -->
		<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
		new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
		j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
		'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
		})(window,document,'script','dataLayer','GTM-579DTGX');</script>
		<!-- End Google Tag Manager -->		<!-- Monthly/Yearly plan A/B testing -->
		<!--
		<script src="https://www.googleoptimize.com/optimize.js?id=OPT-PW3ZPK3"></script>
		-->

		<!-- Donate button A/B testing -->
		<!--
		<script async src="https://www.googleoptimize.com/optimize.js?id=OPT-PW3ZPK3"></script>
		-->		<meta
			charset="utf-8"
			http-equiv="X-UA-Compatible"
			content="IE=edge,chrome=1"
		/>
		<link rel="icon" href="&#x2F;images/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#000000" />
			<meta name="description" content="Joplin encryption, and in particular the E2EE system used during synchronisation, was recently audited by Isaac Potoczny-Jones, CEO of Tozny and this is what he had to say: I was looking through yo..." />
			<meta name="twitter:card" content="summary" />
			<meta name="twitter:site" content="@joplinapp" />
			<meta property="og:url" content="https://joplinapp.org/news/20200406-214254/index.html" />
			<meta property="og:title" content="Joplin informal encryption and security audit results" />
			<meta property="twitter:title" content="Joplin informal encryption and security audit results" />
			<meta property="og:description" content="Joplin encryption, and in particular the E2EE system used during synchronisation, was recently audited by Isaac Potoczny-Jones, CEO of Tozny and this is what he had to say: I was looking through yo..." />
			<meta property="twitter:description" content="Joplin encryption, and in particular the E2EE system used during synchronisation, was recently audited by Isaac Potoczny-Jones, CEO of Tozny and this is what he had to say: I was looking through yo..." />
		<link rel="alternate" type="application/rss+xml" title="Joplin RSS feed" href="https://joplinapp.org/rss.xml" />		<link
			rel="stylesheet"
			href="&#x2F;css/bootstrap5.0.2.min.css"
			as="style"
		/>
		<link rel="stylesheet" href="/css/fontawesome-all.min.css?h=ecd507b3125edc4d2a03aa6ae5d07da9">
		<link
			href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap"
			rel="stylesheet"
			as="style"
			media="all"
			onload="this.media='all'; this.onload = null"
		/>
		<link rel="stylesheet" href="/css/site.css?h=0bfec01592484f7ac1ca50841cd780af" as="style" />
		<title>Joplin informal encryption and security audit results | Joplin</title>

		<script
			src="&#x2F;js/jquery-3.6.0.min.js"
			rel="preload"
			as="script"
		></script>
	</head>
	<body class="website-env-prod">
		<!-- Google Tag Manager (noscript) -->
		<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-579DTGX"
		height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
		<!-- End Google Tag Manager (noscript) -->		
		<div class="container-fluid generic-template news-item-page" id="main-container">

				<div class=" navbar-main white-bg" id="nav-section">
					<div class="container">
						<div class="row">
							<div class="col-3">
								<a href="/">
									<img
										src="&#x2F;images/logo-text-blue.svg"
										alt=""
										id="top-logo"
										width="180"
									/>
								</a>
							</div>
							<div class="col-9 text-right d-none d-md-block">
								<a href="https://twitter.com/joplinapp" title="Joplin Twitter feed" class="fw500 twitter-link"><i class="fab fa-twitter"></i></a>								<a href="/news/" class="fw500">News</a>
								<a href="/help/" class="fw500">Help</a>
								<a href="https:&#x2F;&#x2F;discourse.joplinapp.org&#x2F;" class="fw500">Forum</a>
								<a href="/cn/" class="fw500">ä¸­æ–‡</a>

								<!--
								<div class="dropdown language-switcher">
									<button class="fw500" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
										Language
									</button>
									<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
										<li><a class="dropdown-item" href="#">Action</a></li>
										<li><a class="dropdown-item" href="#">Another action</a></li>
										<li><a class="dropdown-item" href="#">Something else here</a></li>
									</ul>
								</div>
								-->


									<a href="/plans/" class="button-link btn-trans plans-button">Joplin Cloud</a>								<a class="button-link btn-blue sponsor-button" href="/donate">
									<i class="fas fa-heart heart-full"></i><i class="far fa-heart heart-line"></i><span class="sponsor-button-label">&nbsp;Support us</span>
								</a>							</div>
							<div class="col-9 text-right d-block d-md-none navbar-mobile-content">
								<a href="https://twitter.com/joplinapp" title="Joplin Twitter feed" class="fw500 twitter-link"><i class="fab fa-twitter"></i></a>								<a href="/cn/" class="fw500 chinese-page-link">ä¸­æ–‡</a>
								<a href="/plans/" class="button-link btn-trans plans-button">Joplin Cloud</a>								<a class="button-link btn-blue sponsor-button" href="/donate">
									<i class="fas fa-heart heart-full"></i><i class="far fa-heart heart-line"></i><span class="sponsor-button-label">&nbsp;Support us</span>
								</a>
								<span class="pointer"
									><img
										src="&#x2F;images/mobile-menu-black-open-icon.png"
										id="open-menu-mobile"
										alt=""
								/></span>
								&nbsp;&nbsp;

								<div id="menu-mobile">
									<div>
										<div class="text-right">
											<img
												src="&#x2F;images/close-icon.png"
												alt=""
												class="pointer"
												id="close-menu-mobile"
											/>
										</div>

										<div class="text-center menu-mobile-top">
											<a href="/news/" class="fw500 mobile-menu-link">News</a>
											<a href="/help/" class="fw500 mobile-menu-link">Help</a>
											<a href="https:&#x2F;&#x2F;discourse.joplinapp.org&#x2F;" class="fw500 mobile-menu-link">Forum</a>
										</div>

										<div class="menu-mobile-buttons">
												<a href="/plans/" class="button-link btn-trans plans-button">Joplin Cloud</a>											<a class="button-link btn-blue sponsor-button" href="/donate">
												<i class="fas fa-heart heart-full"></i><i class="far fa-heart heart-line"></i><span class="sponsor-button-label">&nbsp;Support us</span>
											</a>										</div>
									</div>


									<div class="row">
										<div class="col-12 col-md-12 social-links">
											<a class="social-link-twitter" href="https://twitter.com/joplinapp" title="Joplin Twitter feed"><i class="fab fa-twitter"></i></a>
											<a class="social-link-mastodon" href="https://mastodon.social/@joplinapp" title="Joplin Mastodon feed"><i class="fab fa-mastodon"></i></a>
											<a class="social-link-patreon" href="https://www.patreon.com/joplin" title="Joplin Patreon"><i class="fab fa-patreon"></i></a>
											<a class="social-link-discord" href="https://discord.gg/VSj7AFHvpq" title="Joplin Discord chat"><i class="fab fa-discord"></i></a>
											<a class="social-link-linkedin" href="https://www.linkedin.com/company/joplin" title="Joplin LinkedIn Feed"><i class="fab fa-linkedin"></i></a>
											<a class="social-link-reddit" href="https://www.reddit.com/r/joplinapp/" title="Joplin Subreddit"><i class="fab fa-reddit"></i></a>
											<a class="social-link-github" href="https://github.com/laurent22/joplin/" title="Joplin GitHub repository"><i class="fab fa-github"></i></a>
										</div>
									</div>
									
									<div>
										<p class="light-blue mobile-menu-link-bottom text-center">
											Copyright &copy; 2016-2023 Laurent&nbsp;Cozic
											<br/>
											<a href="/privacy/" class="fw500">Privacy Policy</a>
										</p>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			<div class="help-page-container page-20200406-214254">
				<div class="container">
					<div class="row content-wrapper">
						

						<div class="main-content">
							<div class="alert alert-danger alert-env-dev" role="alert">
								Running in prod mode!
							</div>
							<div class="donate-links">
<p><a href="https://www.paypal.com/donate/?business=E8JMYD2LQ8MMA&amp;no_recurring=0&amp;item_name=I+rely+on+donations+to+maintain+and+improve+the+Joplin+open+source+project.+Thank+you+for+your+help+-+it+makes+a+difference%21&amp;currency_code=EUR"><img src="https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/Donate-PayPal-green.svg" alt="Donate using PayPal"></a> <a href="https://github.com/sponsors/laurent22/"><img src="https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/GitHub-Badge.svg" alt="Sponsor on GitHub"></a> <a href="https://www.patreon.com/joplin"><img src="https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/Patreon-Badge.svg" alt="Become a patron"></a> <a href="https://joplinapp.org/donate/#donations"><img src="https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/Donate-IBAN.svg" alt="Donate using IBAN"></a></p>
</div>
<h1><a href="/news/20200406-214254/">Joplin informal encryption and security audit results</a><a name="joplin-informal-encryption-and-security-audit-results-news-20200406-214254" href="#joplin-informal-encryption-and-security-audit-results-news-20200406-214254" class="heading-anchor">ðŸ”—</a></h1>
<p><em>Published on <strong>6 Apr 2020</strong></em></p>
<p>Joplin encryption, and in particular the E2EE system used during synchronisation, was recently audited by Isaac Potoczny-Jones, CEO of <a href="https://tozny.com">Tozny</a> and this is what he had to say:</p>
<blockquote>
<p>I was looking through your encryption implementation for Joplin and I have a few comments and concerns. I don't see anything that I *know* is a critical issue, but there are a number of choices and weaknesses that I'd like to lend you some advice about.</p>
</blockquote>
<h3>OBC2<a name="obc2" href="#obc2" class="heading-anchor">ðŸ”—</a></h3>
<blockquote>
<p>OCB2, the chosen multi-block cipher mode has had some weaknesses identified in the last few years. I don't know this mode well since it's not a NIST-approved mode, but here's a paper on the topic. I get the impression it's not considered a good choice anymore. <a href="https://pdfs.semanticscholar.org/bb95/0d82fd390e732f71d8320530994bfb6d2529.pdf">Source</a></p>
</blockquote>
<p>We indeed had been notified about this issue by another cryptographer and had been preparing migration to the more secure CCM mode. Migration for this is now complete in all the Joplin clients and a migration tool has been added to the Encryption config screen of the desktop application. In particular you can perform two operations:</p>
<ul>
<li>Upgrade the master key: This will convert the master key encryption to CCM</li>
<li>Re-encryption: With this tool, you can re-encrypt all your data using the new encryption method based on CCM. Please follow the instructions on this screen and note that this process can take quite a bit of time so it's better to plan for it and run it over night. It is not entirely clear how the OBC2 flaw can be exploited but it is best to upgrade your data as soon as possible.</li>
</ul>
<h3>Unnecessary key expansions<a name="unnecessary-key-expansions" href="#unnecessary-key-expansions" class="heading-anchor">ðŸ”—</a></h3>
<blockquote>
<p>Running key expansion on a random key: Your encrypt function uses either 1k or 10k roundsÂ of key derivation. The goal of this is to reduce brute-force attacks against user-chosen passwords. This function appears to me to be used for both password-based key derivation (at 10k rounds) *and* bulk encryption of data from a randomly-generated &quot;master key&quot; (at 1k rounds). The bulk encryption does not need the password expansion since the key is randomly generated (presumably with a cryptographically strong generator). I suspect this could be a major performance issue on the bulk encryption of raw data, so if you're finding encryption slow, this is maybe why.</p>
</blockquote>
<p>This is more a performance than a security issue. Indeed, the previous encryption method was using 1,000 key expansion iterations every time a note was encrypted, which is unnecessary since the master key is already secured with 10,000 iterations. As a result the encryption algorithm has been changed to perform only 100 iterations when encrypting notes, which should result in faster encryption and decryption on the desktop, mobile and CLI applications.</p>
<h3>Unnecessary and potentially insecure master key checksum<a name="unnecessary-and-potentially-insecure-master-key-checksum" href="#unnecessary-and-potentially-insecure-master-key-checksum" class="heading-anchor">ðŸ”—</a></h3>
<blockquote>
<p>You make and store a checksum of the master password with SHA256 in addition to encrypting it. I expect this is because you need a way to tell if the user's password is correct. I've never seen this done before, and it has me concerned, but I don't know for sure that it's an issue. Thought I'd mention it anyway. <a href="https://crypto.stackexchange.com/questions/61915/can-i-hash-a-secret-key-and-used-the-hash-as-key-id">Source</a>. At least with CCM mode (and I think with OCB2) it shouldn't successfully decrypt if you have the wrong password.</p>
</blockquote>
<p>A checksum was previously stored with the master key to verify that it is valid. This could potentially weaken the security of the mater key since, as mentioned in Cryptography StackExchange link, &quot;in the standard model of hash functions there isn't a requirement that hash outputs not have properties that leak information about the input&quot;. It was also unnecessary since the decryption algorithm in use would fail if the key is invalid, so the additional checksum was not needed.<br>
This has also been addressed by the new master key upgrading tool. If you have performed the upgrade, the checksum will be gone from your master key.</p>
<h3>Encrypting local secrets with a keychain service<a name="encrypting-local-secrets-with-a-keychain-service" href="#encrypting-local-secrets-with-a-keychain-service" class="heading-anchor">ðŸ”—</a></h3>
<blockquote>
<p>Now I did notice that you cache the plain text password in the database, which is a bit concerning, but I guess the security model of your encryption approach is that it happens during sync, not locally. The generally accepted approach [to store secrets] is to use a keychain service, which is available pretty much on all modern platforms.</p>
</blockquote>
<p>Passwords are indeed cached locally, so that you don't have to input it again every time a note needs to be encrypted or decrypted for synchronisation. It is assumed that your local device is secure, which is why for now passwords were cached locally.<br>
To improve security however, future versions of Joplin will use the system keychain whenever it is available. A <a href="https://github.com/laurent22/joplin/pull/2861">pull request</a> is in progress to add this feature.<br>
To conclude I'd like to thank Isaac Potoczny-Jones for conducting this audit and revealing these potential security issues. Joplin is now much safer as a result.</p>
<hr>
<p><a href="https://discourse.joplinapp.org/c/news/9"><i class="fab fa-discourse"></i> Discuss on the forum</a></p>

						</div>
					</div>
				</div>
			</div>

			
			<footer class="darkblue-bg">
				<div class="container">
					<div class="row">
						<div class="col-12 col-md-12 social-links">
							<a class="social-link-twitter" href="https://twitter.com/joplinapp" title="Joplin Twitter feed"><i class="fab fa-twitter"></i></a>
							<a class="social-link-mastodon" href="https://mastodon.social/@joplinapp" title="Joplin Mastodon feed"><i class="fab fa-mastodon"></i></a>
							<a class="social-link-patreon" href="https://www.patreon.com/joplin" title="Joplin Patreon"><i class="fab fa-patreon"></i></a>
							<a class="social-link-discord" href="https://discord.gg/VSj7AFHvpq" title="Joplin Discord chat"><i class="fab fa-discord"></i></a>
							<a class="social-link-linkedin" href="https://www.linkedin.com/company/joplin" title="Joplin LinkedIn Feed"><i class="fab fa-linkedin"></i></a>
							<a class="social-link-reddit" href="https://www.reddit.com/r/joplinapp/" title="Joplin Subreddit"><i class="fab fa-reddit"></i></a>
							<a class="social-link-github" href="https://github.com/laurent22/joplin/" title="Joplin GitHub repository"><i class="fab fa-github"></i></a>
						</div>
					</div>

					<div class="row bottom-links-row">
						<div class="col-12 col-md-6">
							<p class="text-center-sm">Copyright &copy; 2016-2023 Laurent Cozic</p>
						</div>
						<div class="col-12 col-md-6">
							<p class="text-right text-center-sm right-links">
								<span class="footer-right">
									<a href="/privacy/">Privacy Policy</a>
								</span>
							</p>
						</div>
					</div>
				</div>
			</footer>		</div>

		<script
			src="&#x2F;js/bootstrap5.0.2.bundle.min.js"
			rel="preload"
			as="script"
		></script>
		<script src="/js/script.js?h=b1cc510889690b9703c87eafe6c3e8e0"></script>

		<script>
			if (window.location.hostname !== 'localhost') {
				(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
				})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
				ga('create', 'UA-103586105-1', 'auto');
				ga('send', 'pageview');
			}
		</script>	</body>
</html>
