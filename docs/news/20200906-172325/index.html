<!DOCTYPE html>
<html lang="en">

<!--

!!! WARNING !!!

This file was auto-generated from readme/news/20200906-172325.md and any manual change
made to it will be overwritten. To make a change to this file please modify
the source Markdown file:

https://github.com/laurent22/joplin/blob/dev/readme/news/20200906-172325.md

-->

	<head>
<!-- Donate button A/B testing -->

<!--
<script async src="https://www.googleoptimize.com/optimize.js?id=OPT-PW3ZPK3"></script>
-->		<meta
			charset="utf-8"
			http-equiv="X-UA-Compatible"
			content="IE=edge,chrome=1"
		/>
		<link rel="icon" href="&#x2F;images/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#000000" />
	<meta name="description" content="The latest version of Joplin includes a mechanism to upgrade the structure of a sync target. When you startup the app you will be asked to upgrade before being able to sync. Once you start the proc..." />
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:site" content="@joplinapp" />
	<meta property="og:url" content="https://joplinapp.org/news/20200906-172325/index.html" />
	<meta property="og:title" content="Improving the sync process in Joplin" />
	<meta property="og:description" content="The latest version of Joplin includes a mechanism to upgrade the structure of a sync target. When you startup the app you will be asked to upgrade before being able to sync. Once you start the proc..." />
		<link
			rel="stylesheet"
			href="&#x2F;css/bootstrap5.0.2.min.css"
			as="style"
		/>
		<link rel="stylesheet" href="/css/fontawesome-all.min.css?h=ecd507b3125edc4d2a03aa6ae5d07da9">
		<link
			href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap"
			rel="stylesheet"
			as="style"
			media="all"
			onload="this.media='all'; this.onload = null"
		/>
		<link rel="stylesheet" href="/css/site.css?h=7ed2ae55b61de5eedd69b48d4e6b5400" as="style" />
		<title>Improving the sync process in Joplin | Joplin</title>

		<script
			src="&#x2F;js/jquery-3.6.0.min.js"
			rel="preload"
			as="script"
		></script>
	</head>
	<body class="website-env-prod">
		<div class="container-fluid generic-template news-item-page" id="main-container">

<div class=" navbar-main white-bg" id="nav-section">
	<div class="container">
		<div class="row">
			<div class="col-3">
				<a href="/">
					<img
						src="&#x2F;images/logo-text-blue.svg"
						alt=""
						id="top-logo"
						width="180"
					/>
				</a>
			</div>
			<div class="col-9 text-right d-none d-md-block">
<a href="https://twitter.com/joplinapp" title="Joplin Twitter feed" class="fw500"><i class="fab fa-twitter"></i></a>				<a href="/news/" class="fw500">News</a>
				<a href="/help/" class="fw500">Help</a>
				<a href="https:&#x2F;&#x2F;discourse.joplinapp.org&#x2F;" class="fw500">Forum</a>
<a href="/plans/" class="button-link btn-trans plans-button">Joplin Cloud</a><a class="button-link btn-blue sponsor-button" href="/donate">
	<i class="fas fa-heart heart-full"></i><i class="far fa-heart heart-line"></i><span class="sponsor-button-label">&nbsp;Support us</span>
</a>			</div>
			<div class="col-9 text-right d-block d-md-none navbar-mobile-content">
<a href="https://twitter.com/joplinapp" title="Joplin Twitter feed" class="fw500"><i class="fab fa-twitter"></i></a><a class="button-link btn-blue sponsor-button" href="/donate">
	<i class="fas fa-heart heart-full"></i><i class="far fa-heart heart-line"></i><span class="sponsor-button-label">&nbsp;Support us</span>
</a>
				<span class="pointer"
					><img
						src="&#x2F;images/mobile-menu-black-open-icon.png"
						id="open-menu-mobile"
						alt=""
				/></span>
				&nbsp;&nbsp;

				<div id="menu-mobile">
					<div>
						<div class="text-right">
							<img
								src="&#x2F;images/close-icon.png"
								alt=""
								class="pointer"
								id="close-menu-mobile"
							/>
						</div>

						<div class="text-center menu-mobile-top">
							<a href="/news/" class="fw500 mobile-menu-link">News</a>
							<a href="/help/" class="fw500 mobile-menu-link">Help</a>
							<a href="https:&#x2F;&#x2F;discourse.joplinapp.org&#x2F;" class="fw500 mobile-menu-link">Forum</a>
						</div>

						<div class="menu-mobile-buttons">
<a href="/plans/" class="button-link btn-trans plans-button">Joplin Cloud</a><a class="button-link btn-blue sponsor-button" href="/donate">
	<i class="fas fa-heart heart-full"></i><i class="far fa-heart heart-line"></i><span class="sponsor-button-label">&nbsp;Support us</span>
</a>						</div>
					</div>


<div class="row">
	<div class="col-12 col-md-12 social-links">
		<a class="social-link-twitter" href="https://twitter.com/joplinapp" title="Joplin Twitter feed"><i class="fab fa-twitter"></i></a>
		<a class="social-link-mastodon" href="https://mastodon.social/@joplinapp" title="Joplin Mastodon feed"><i class="fab fa-mastodon"></i></a>
		<a class="social-link-patreon" href="https://www.patreon.com/joplin" title="Joplin Patreon"><i class="fab fa-patreon"></i></a>
		<a class="social-link-discord" href="https://discord.gg/VSj7AFHvpq" title="Joplin Discord chat"><i class="fab fa-discord"></i></a>
		<a class="social-link-reddit" href="https://www.reddit.com/r/joplinapp/" title="Joplin Subreddit"><i class="fab fa-reddit"></i></a>
		<a class="social-link-github" href="https://github.com/laurent22/joplin/" title="Joplin GitHub repository"><i class="fab fa-github"></i></a>
	</div>
</div>
					
					<div>
						<p class="light-blue mobile-menu-link-bottom text-center">
							Copyright &copy; 2016-2022 Laurent&nbsp;Cozic
							<br/>
							<a href="/privacy/" class="fw500">Privacy Policy</a>
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
			<div class="help-page-container page-20200906-172325">
				<div class="container">
					<div class="row content-wrapper">
						

						<div class="main-content">
							<div class="alert alert-danger alert-env-dev" role="alert">
								Running in prod mode!
							</div>
							<div class="donate-links">
<p><a href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&amp;business=E8JMYD2LQ8MMA&amp;lc=GB&amp;item_name=Joplin+Development&amp;currency_code=EUR&amp;bn=PP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHosted"><img src="https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/Donate-PayPal-green.svg" alt="Donate using PayPal"></a> <a href="https://github.com/sponsors/laurent22/"><img src="https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/GitHub-Badge.svg" alt="Sponsor on GitHub"></a> <a href="https://www.patreon.com/joplin"><img src="https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/Patreon-Badge.svg" alt="Become a patron"></a> <a href="https://joplinapp.org/donate/#donations"><img src="https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/Donate-IBAN.svg" alt="Donate using IBAN"></a></p>
</div>
<h1><a href="/news/20200906-172325/">Improving the sync process in Joplin</a><a name="improving-the-sync-process-in-joplin-news-20200906-172325" href="#improving-the-sync-process-in-joplin-news-20200906-172325" class="heading-anchor">🔗</a></h1>
<p><em>Published on <strong>6 Sep 2020</strong></em></p>
<p>The latest version of Joplin includes a mechanism to upgrade the  structure of a sync target. When you startup the app you will be asked  to upgrade before being able to sync. Once you start the process, the  app will briefly display an information screen, upgrade the sync target,  and then restart the app. You’ll then be able to sync with the new sync  target format. That first upgrade is quite simple as the goal for now  is to put the mechanism in place and verify that it works well.</p>
<p>From a user perspective this feature doesn’t do anything visible, although <a href="https://github.com/laurent22/joplin/issues/3692#issuecomment-685679213">it caused some issues</a>, so one might wonder why it’s even there. This post is meant to clarify this.</p>
<p>The structure of the sync target hasn’t really changed since the day  Joplin was released. It works well however it has some shortcomings that  should be fixed eventually for sync to remain performant.</p>
<p>There are also various improvements that could be made but were not  previously possible due to the lack of an upgrade mechanism. I have  listed below the 5 main limitations or issues with the current sync  process and how they could be fixed:</p>
<h3>No upper limit on the number of items<a name="no-upper-limit-on-the-number-of-items" href="#no-upper-limit-on-the-number-of-items" class="heading-anchor">🔗</a></h3>
<p>Joplin’s UI works well even with millions of notes, however the sync  target will keep getting slower and slower as more files are added to  it. File systems often have a limit to the number of files they can  support in a directory. One user also has reached <a href="https://discourse.joplinapp.org/t/limit-on-the-number-of-child-items-was-reached/3804">the limit of 150,000 items on OneDrive</a>.</p>
<p>For now, this is not a big issue because most users don’t have  millions of items, but as more web pages are being clipped (clipped  pages often contain many small resources and images) and more note  revisions are created (one note can have hundreds of revisions), this  issue might start affecting more users.</p>
<p>One way to solve this issue would be to split the sync items into  multiple directories. For example if we split the main directory into  100 sub-directories, it will be possible to have 15,000,000 OneDrive  items instead of 150,000. Another way would be to support note  archiving, as described below. How exactly we’ll handle this problem is  still to be defined, but there are certainly ways.</p>
<h3>Not possible to prioritise downloads<a name="not-possible-to-prioritise-downloads" href="#not-possible-to-prioritise-downloads" class="heading-anchor">🔗</a></h3>
<p>Currently, when syncing, the items are downloaded in a random way. So  it might download some notes, then some tags and notebooks, then back  to downloading notes, etc. For small sync operations it doesn’t matter,  but large ones, like when setting up a new device, it is very  inefficient. For example, the app might download hundreds of note  revisions or tags, but won’t display anything for a while because it  won’t have downloaded notebooks or notes.</p>
<p>A simple improvement would be to group the items by type on the sync  target. So all notebook items together, all tags together, etc. Doing so  means when syncing we can first download the notebooks, then the notes,  which means something will be displayed almost immediately in the app,  allowing the user to start using it. Then later less important items  like tags or note revisions will be downloaded.</p>
<h3>End-to-end encryption is hard to setup<a name="end-to-end-encryption-is-hard-to-setup" href="#end-to-end-encryption-is-hard-to-setup" class="heading-anchor">🔗</a></h3>
<p>Currently, the encryption settings is a property of the clients. What  it means it that when you setup a new client, it doesn’t know whether  the other clients use encryption or not. It’s going to guess more or  less based on the data on the sync target. You can also force it to use  encryption but this has drawbacks and often mean a new master key is  going to be created, even though there might already be one on the sync  target.</p>
<p>E2EE works well once it’s setup, but doing so can be tricky and possibly confusing - if you didn’t follow <a href="https://joplinapp.org/e2ee/">this guide</a> to the letter, you might end up with multiple master keys, or sending decrypted notes to an encrypted target.</p>
<p>A way to solve this would be to make the E2EE settings a property of  the sync target. Concretely there would be a file that tells if E2EE is  enabled or not, and maybe some way to quickly get the master key. It  would simplify setting up encryption a lot and make it more secure  (because you won’t be able to send non-encrypted notes to an encrypted  sync target). When you setup a new client, the client will know  immediately if it’s an encrypted target or not and set the client  accordingly.</p>
<h3>Old notes that never change should be handled differently<a name="old-notes-that-never-change-should-be-handled-differently" href="#old-notes-that-never-change-should-be-handled-differently" class="heading-anchor">🔗</a></h3>
<p>It would be more efficient to treat old notes differently by allowing  the user to “archive” them. An archived note would be read-only. Then  one idea could be to group all these archived notes into a ZIP file on  the sync target. Doing so means that the initial sync would be much  faster (instead of downloading hundred of small files, which is slow, it  will download one large file, which is fast). It would also make the  structure more scalable - you could keep several years of archived notes  on the sync target while keeping sync fast and efficient.</p>
<h3>The resource directory should be renamed<a name="the-resource-directory-should-be-renamed" href="#the-resource-directory-should-be-renamed" class="heading-anchor">🔗</a></h3>
<p>The folder that contains file attachments is named “.resources” on  the sync target. This causes troubles because certain platforms will  hide directories that start with dot “.”, and perhaps they will be  excluded from backup or skipped when moved somewhere else. Being able to  upgrade the sync target means we can rename this folder to just  “resources” instead.</p>
<h3>Conclusion<a name="conclusion" href="#conclusion" class="heading-anchor">🔗</a></h3>
<p>That’s obviously a lot of possible improvements and it won’t be done  overnight, but having the sync upgrade mechanism in place means we can  start considering these options. Some of these, such as renaming the  “resources” dir are simpler and could be done relatively soon. Perhaps  other more complex ones will be group within one sync target upgrade to  minimise disruption. In any case, I hope this clarifies the reason for  this recent sync upgrade and that it gives some ideas of what to expect  in the future.</p>
<hr>
<p><a href="https://discourse.joplinapp.org/c/news/9"><i class="fab fa-discourse"></i> Discuss on the forum</a></p>

						</div>
					</div>
				</div>
			</div>

			
<footer class="darkblue-bg">
	<div class="container">
<div class="row">
	<div class="col-12 col-md-12 social-links">
		<a class="social-link-twitter" href="https://twitter.com/joplinapp" title="Joplin Twitter feed"><i class="fab fa-twitter"></i></a>
		<a class="social-link-mastodon" href="https://mastodon.social/@joplinapp" title="Joplin Mastodon feed"><i class="fab fa-mastodon"></i></a>
		<a class="social-link-patreon" href="https://www.patreon.com/joplin" title="Joplin Patreon"><i class="fab fa-patreon"></i></a>
		<a class="social-link-discord" href="https://discord.gg/VSj7AFHvpq" title="Joplin Discord chat"><i class="fab fa-discord"></i></a>
		<a class="social-link-reddit" href="https://www.reddit.com/r/joplinapp/" title="Joplin Subreddit"><i class="fab fa-reddit"></i></a>
		<a class="social-link-github" href="https://github.com/laurent22/joplin/" title="Joplin GitHub repository"><i class="fab fa-github"></i></a>
	</div>
</div>

		<div class="row bottom-links-row">
			<div class="col-12 col-md-6">
				<p class="text-center-sm">Copyright &copy; 2016-2022 Laurent Cozic</p>
			</div>
			<div class="col-12 col-md-6">
				<p class="text-right text-center-sm right-links">
					<span class="footer-right">
						<a href="/privacy/">Privacy Policy</a>
					</span>
				</p>
			</div>
		</div>
	</div>
</footer>		</div>

		<script src="/js/script.js?h=46b3b58d72c94591621551affbb8c6e3"></script>

<script>
	if (window.location.hostname !== 'localhost') {
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-103586105-1', 'auto');
		ga('send', 'pageview');
	}
</script>	</body>
</html>
